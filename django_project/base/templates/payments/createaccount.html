{% extends "project_base.html" %}

 {% block title %}Make Donation - {{ block.super }}{% endblock %}
 {% block js_head %}
     <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
 {% endblock %}

 {% block extra_head %}
 {% endblock %}

 {% block page_title %}
     <h1>Make payment</h1>
 {% endblock page_title %}

 {% block content %}
  <script type="text/javascript">
         // This identifies our website in the createToken call below
     Stripe.setPublishableKey('pk_test_Hfs5jjuxLeOiEtUgtlQFF8Jz');
     function stripeResponseHandler(status, response){
       var $form = $('#payment-form');

       if (response.error) {
         // show the errors on the form
         $form.find('.payment-errors').text(response.error.message);
         $form.find('button').prop('disabled', false);
       } else {
         // response contains id and card, which contains additional card details
         var token = response.id;
         // insert the token into the form so it gets submitted to the server
         $form.append($('<input type="hidden" name="stripeToken"/>').val(token.id));
         // then submitt
         $form.get(0).submit();
       }
     };

     $(document).ready(function(){
       jQuery(function($){
         $('#payment-form').submit(function(event){
           var $form = $(this);

           //disable the submitt button to prevent repeated clicks
           $form.find('button').prop('disable', true);

           Stripe.card.createToken($form, stripeResponseHandler);

           //prevent the form from submitting with the default action
           return false;
         });
       });
     });
     </script>
     <style>
         h1 {
             margin-top: 2pt;
             margin-bottom: 4pt;
         }
     </style>
 <div class="row">
     <div class="page-header col-sm-4 col-sm-offset-4">
         <div class="container">
             <div class="row-fluid">
               <h1>Make a donation <br/>
                   <small>credit or debit card</small>
               </h1>
             </div>
         </div>
     </div>
 </div>

  <div class="row">
  <div class="col-sm-4 col-sm-offset-4">
      <blockquote>You are donating a sum of <strong>{{ charge_currency }} {{ donation_amount }}</strong></blockquote>
  </div>
   <div class="col-sm-4 col-sm-offset-4">
     <form class="form" action="" method="POST" id="payment-form">{% csrf_token %}
         <span class="payment-errors"></span>

        <div class="form-row">
             <label>
                 <span>Card Number</span>
                 <input class="form-control" type="text" size="20" data-stripe="number"/>
             </label>
         </div>

         <div class="form-row">
             <label>
                 <span>CVC</span>
                 <input type="text" size="4" data-stripe="cvc"/>
             </label>
         </div>

         <div class="form-row">
             <label>
                 <span>Expiration (MM/YYYY)</span>
                 <input type="text" size="2" data-stripe="exp-month"/>
             </label>
             <span> / </span>
             <input type="text" size="4" data-stripe="exp-year"/>
         </div>

         <button class="btn btn-success" type="submit">Submit Payment</button>
     </form>
   </div>
 </div>


{#     new form #}
{#     <form action={% url 'process-view' %} method="post" id="payment-form">#}
{#  <div class="form-row">#}
{#    <label for="card-element">#}
{#      Credit or debit card#}
{#    </label>#}
{#    <div id="card-element">#}
{#      <!-- a Stripe Element will be inserted here. -->#}
{#    </div>#}
{##}
{#    <!-- Used to display Element errors -->#}
{#    <div id="card-errors" role="alert"></div>#}
{#  </div>#}
{##}
{#  <button type="submit" class="btn btn-primary">Submit Payment</button>#}
{#</form>#}
{#     <script>#}
{#    var stripe = Stripe('pk_test_Hfs5jjuxLeOiEtUgtlQFF8Jz');#}
{#    var elements = stripe.elements();#}
{#    var style = {#}
{#      base: {#}
{#        // Add your base input styles here. For example:#}
{#        fontSize: '16px',#}
{#        lineHeight: '24px'#}
{#      }#}
{#    };#}
{##}
{#    // Create an instance of the card Element#}
{#    var card = elements.create('card', {style: style});#}
{##}
{#    // Add an instance of the card Element into the `card-element` <div>#}
{#    card.mount('#card-element');#}
{#    card.addEventListener('change', function(event) {#}
{#      var displayError = document.getElementById('card-errors');#}
{#      if (event.error) {#}
{#        displayError.textContent = event.error.message;#}
{#      } else {#}
{#        displayError.textContent = '';#}
{#      }#}
{#    });#}
{##}
{#    // Create a token or display an error when the form is submitted.#}
{#    var form = document.getElementById('payment-form');#}
{#    form.addEventListener('submit', function(event) {#}
{#      event.preventDefault();#}
{##}
{#      stripe.createToken(card).then(function(result) {#}
{#        if (result.error) {#}
{#          // Inform the user if there was an error#}
{#          var errorElement = document.getElementById('card-errors');#}
{#          errorElement.textContent = result.error.message;#}
{#        } else {#}
{#          // Send the token to your server#}
{#          stripeTokenHandler(result.token);#}
{#        }#}
{#      });#}
{#    });#}
{#    function stripeTokenHandler(token) {#}
{#      // Insert the token ID into the form so it gets submitted to the server#}
{#      var form = document.getElementById('payment-form');#}
{#      var hiddenInput = document.createElement('input');#}
{#      hiddenInput.setAttribute('type', 'hidden');#}
{#      hiddenInput.setAttribute('name', 'stripeToken');#}
{#      hiddenInput.setAttribute('value', token.id);#}
{#      form.appendChild(hiddenInput);#}
{##}
{#      // Submit the form#}
{#      form.submit();#}
{#    }#}
{#</script>#}

 {% endblock %}